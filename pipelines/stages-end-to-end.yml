stages:
- stage: BuildApp
  displayName: Build App
  jobs:
  - template: jobs-build-app.yml

- stage: AwsSetup
  displayName: AWS Setup
  jobs:
  - template: job-aws-setup.yml
      
- stage: DeployApp
  displayName: Deploy App
  jobs:
  - template: jobs-deploy-app.yml
      
- stage: TestApp
  displayName: Test App
  jobs:
  - template: jobs-test-app.yml

- stage: AwsCleanup
  displayName: AWS Cleanup
  # The pipeline has moved on beyond BuildApp so potentially AWS infrastructure has been built
  condition: succeeded('BuildApp')
  jobs:
  - template: job-aws-destroy.yml